{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://@dhtml/persona/webpack/bootstrap","webpack://@dhtml/persona/webpack/runtime/compat get default export","webpack://@dhtml/persona/webpack/runtime/define property getters","webpack://@dhtml/persona/webpack/runtime/hasOwnProperty shorthand","webpack://@dhtml/persona/webpack/runtime/make namespace object","webpack://@dhtml/persona/external root \"flarum.core.compat['common/app']\"","webpack://@dhtml/persona/./src/common/index.ts","webpack://@dhtml/persona/external root \"flarum.core.compat['forum/app']\"","webpack://@dhtml/persona/external root \"flarum.core.compat['common/extend']\"","webpack://@dhtml/persona/external root \"flarum.core.compat['common/components/Button']\"","webpack://@dhtml/persona/external root \"flarum.core.compat['common/components/HeaderSecondary']\"","webpack://@dhtml/persona/external root \"flarum.core.compat['common/components/SelectDropdown']\"","webpack://@dhtml/persona/./src/forum/component/addPersonaMenu.js","webpack://@dhtml/persona/./src/forum/index.js"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/app'];","import app from 'flarum/common/app';\n\napp.initializers.add('dhtml/persona', () => {\n  //console.log('[dhtml/persona] Hello, forum and admin!');\n});\n","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/app'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/extend'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Button'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/HeaderSecondary'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/SelectDropdown'];","import { extend } from 'flarum/common/extend';\nimport app from 'flarum/forum/app';\nimport Button from 'flarum/common/components/Button';\nimport HeaderSecondary from 'flarum/common/components/HeaderSecondary';\nimport SelectDropdown from 'flarum/common/components/SelectDropdown';\n\n\nexport const loginUser = (username) => {\n  if(username=='Add New User') {\n    return addNewUser();\n  }\n\n  return app.request({\n    method: 'POST',\n    url: `${app.forum.attribute('baseUrl')}/api/persona-login`,\n    body: {\n      username: username\n    }\n  }).then(response => {\n    window.location.reload();\n  }).catch(error => {\n    console.error('Login failed', error);\n    alert(\"Login failed\");\n    // Handle login error, e.g., show an error message to the user\n  });\n}\n\nexport const addNewUser = () => {\n  let username = prompt(\"Enter username\",\"\");\n  username = username.trim();\n\n  if(username==\"\") {return;}\n\n  return app.request({\n    method: 'POST',\n    url: `${app.forum.attribute('baseUrl')}/api/persona-register`,\n    body: {\n      username: username\n    }\n  }).then(response => {\n    window.location.reload();\n  }).catch(error => {\n    console.log(error);\n    console.error('Register failed');\n  });\n}\n\nexport const doesEmailMatchPatterns = (email, patterns) => {\n  return Object.values(patterns).some(pattern => pattern && email.includes(pattern));\n};\n\n\nexport default function () {\n\n  extend(HeaderSecondary.prototype, 'items', function (items) {\n\n\n    const user = app.session.user;\n\n    let isModerator = false;\n    let email = '';\n\n    if (user) {\n      email = user.email();\n      isModerator = user.groups().some(group => {\n        const groupId = group.data.id;\n        return groupId === '1' || groupId === '4';\n      });\n    } else {\n      return; //no point\n    }\n\n    const _username = user.username();\n\n    const patterns = {\n      pattern1: app.forum.attribute('domainpattern1'),\n      pattern2: app.forum.attribute('domainpattern2'),\n      pattern3: app.forum.attribute('domainpattern3')\n    };\n\n    const userData = {email, patterns};\n\n    const isFilteredUser = doesEmailMatchPatterns(email,patterns);\n\n\n    if(!isModerator && !isFilteredUser) {return;}\n\n    const decodedArray = JSON.parse(app.forum.attribute('dhtmlPersonaUsers'));\n    decodedArray.unshift(\"Add New User\");\n\n\n    const users = [];\n\n\n    for (let i = 0; i < decodedArray.length; i++) {\n      const user = decodedArray[i];\n\n      if(_username == user) continue;\n\n      users.push(\n        <Button icon={'fas fa-user'} onclick={() => {loginUser(user);}}\n        >\n          {user}\n        </Button>\n      );\n    }\n\n    const label = app.translator.trans('dhtml-persona.forum.persona')\n\n    items.add(\n      'persona',\n      <SelectDropdown\n        buttonClassName=\"Button Button--link\"\n        accessibleToggleLabel={label}\n      >\n        {users}\n      </SelectDropdown>,\n      21\n    );\n\n  });\n\n}\n","import app from 'flarum/forum/app';\nimport addPersonaMenu from \"./component/addPersonaMenu\";\n\napp.initializers.add('dhtml/persona', () => {\n  //console.log('[dhtml/persona] Hello, forum!');\n\n  addPersonaMenu();\n\n});\n"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","flarum","core","compat","app","add","extend","HeaderSecondary","items","user","isModerator","email","groups","some","group","groupId","data","id","_username","username","isFilteredUser","patterns","values","pattern","includes","doesEmailMatchPatterns","pattern1","attribute","pattern2","pattern3","decodedArray","JSON","parse","unshift","users","_loop","i","push","m","Button","icon","onclick","prompt","trim","method","url","body","then","response","window","location","reload","error","console","log","addNewUser","alert","length","label","trans","SelectDropdown","buttonClassName","accessibleToggleLabel","addPersonaMenu"],"sourceRoot":""}